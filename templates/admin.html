<!doctype html>
<html>
<head>
  <title>Admin - Courses</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<h1>Course Manager - Admin</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul>
      {% for cat, msg in messages %}
        <li><strong>{{ cat }}:</strong> {{ msg }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<h2>Create Course</h2>
<form method="post" action="{{ url_for('create_course') }}">
  <label>Name: <input type="text" name="name" required></label><br>
  <label>Start date: <input type="date" name="start_date" required></label><br>
  <label>End date: <input type="date" name="end_date" required></label><br>
  <label>Hotel night 1: <input type="date" name="hotel_night1"></label><br>
  <label>Hotel night 2: <input type="date" name="hotel_night2"></label><br>
  <label>Hotel night 3: <input type="date" name="hotel_night3"></label><br>
  <button type="submit">Create</button>
</form>

<hr>

<h2>Courses</h2>
<ul>
{% for c in courses %}
  <li>
    <a href="{{ url_for('course_detail', course_id=c.id) }}">{{ c.name }}</a>
    ({{ c.start_date }} - {{ c.end_date }})
  </li>
{% endfor %}
</ul>

{% if course %}
<hr>
<h2>Course: {{ course.name }}</h2>

<h3>Upload participants</h3>
<form method="post" action="{{ url_for('upload_participants', course_id=course.id) }}" enctype="multipart/form-data">
  <input type="file" name="file" required>
  <button type="submit">Upload</button>
  <p>CSV or Excel with at least a column named 'email'. Optional: 'first_name', 'last_name'.</p>
</form>

<h3>Participants</h3>
<table border="1" cellpadding="4">
  <tr>
    <th>Email</th><th>Name</th><th>Status</th>
  </tr>
  {% for p in participants %}
  <tr>
    <td>{{ p.email }}</td>
    <td>{{ p.first_name }} {{ p.last_name }}</td>
    <td>{{ p.status }}</td>
  </tr>
  {% endfor %}
</table>

<form method="post" action="{{ url_for('send_initial', course_id=course.id) }}">
  <button type="submit">Send initial RSVP emails</button>
</form>

<h3>Custom Questions</h3>
<table border="1" cellpadding="4">
  <tr><th>Order</th><th>Label</th><th>Required</th></tr>
  {% for q in questions %}
  <tr>
    <td>{{ q.order_index }}</td>
    <td>{{ q.label }}</td>
    <td>{{ 'Yes' if q.required else 'No' }}</td>
  </tr>
  {% endfor %}
</table>

<form method="post" action="{{ url_for('add_question', course_id=course.id) }}">
  <h4>Add question</h4>
  <label>Label: <input type="text" name="label" required></label><br>
  <label>Required: <input type="checkbox" name="required" checked></label><br>
  <label>Order: <input type="number" name="order_index" value="0"></label><br>
  <button type="submit">Add question</button>
</form>

<h3>Hotel summary</h3>
<a href="{{ url_for('hotel_summary', course_id=course.id) }}">View hotel summary</a>

<h3>Export</h3>
<a href="{{ url_for('export_excel', course_id=course.id) }}">Download Excel export</a>

{% endif %}

</body>
</html>
